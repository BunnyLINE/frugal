requires: 
  Workiva/frugal: binary

run:
  when-branch-name-is:
    - .+

image: "docker.webfilings.org/wlayout/smithy-runner-thrift:1.5"

env:
  - GORACE="halt_on_errors=1"

scripts:
  - testing=$PWD
  - cd ..
  - mkdir go
  - cd go
  - wget https://storage.googleapis.com/golang/go1.5.2.src.tar.gz
  - tar -xzf go1.5.2.src.tar.gz --exclude=.git
  - export GOPATH=$PWD
  - export PATH=$PATH:$GOPATH/bin
  - mkdir -p $GOPATH/src/github.com/Workiva
  - cp -r $testing $GOPATH/src/github.com/Workiva/frugal
  - cd $GOPATH/src/github.com/Workiva/frugal
  - frugal=$PWD
  - go get bitbucket.org/tebeka/go2xunit
  - go get -v github.com/tools/godep
  - godep go install
  - rm -rf $frugal/example/go/gen-go
  - cd $frugal/example
  - frugal -gen=go event.frugal
  - mv gen-go go

  # Start nats server
  - cd $testing
  - go get github.com/nats-io/gnatsd
  - gnatsd &

  - cd $frugal
  - ./scripts/run_tests_skynet.sh

timeout: long

test-reports:
  - /testing/reports
